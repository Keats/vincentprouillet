<!DOCTYPE html>
<html lang="en-gb">
    <head>
      <meta charset="UTF-8">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="
    A framework agnostic approach to routing for SPA: now in production
">
      <meta name="author" content="Vincent Prouillet">
      <title>Vincent Prouillet: Developer &amp; Entrepreneur</title>
      <link rel="stylesheet" href="https://www.vincentprouillet.com/site.css?h=6dba58370284a334effb" />
      <link rel="shortcut icon" type="image/png" href="https://www.vincentprouillet.com/favicon.ico"/>
      <link href="https://www.vincentprouillet.com/rss.xml" rel="feed" type="application/rss+xml" title="Vincent Prouillet: Developer &amp; Entrepreneur" />
    </head>

    <header id="header">
        <h1 class="logo"><a href="/">Vincent Prouillet</a></h1>
        <ul>
            <li><a href="/blog/">Blog</a></li>
        </ul>
    </header>

    <div id="content">
        
    <div class="post">
        <div class="post__title">
            <h1>A different approach to routing in Single-Page Applications: now in production</h1>
            <div class="post__meta">
                2017-05-24
                
            </div>
            <hr />
        </div>

        <div class="post__body">
            <p>I've recently wrote <a href="https://www.vincentprouillet.com/blog/testing-a-different-spa-routing/">an article</a> about a
framework agnostic routing approach for SPA and promised to post an update once it is a bit more tested.
I have since moved Proppy from <a href="https://github.com/ReactTraining/react-router">react-router</a> v2 to
the structure described in my article and the result is pretty great!</p>
<p>I did change a few things from it though.</p>
<p>First, the <code>onClick</code> of the <code>Link</code> component was incorrect and has been changed to:</p>
<pre data-lang="ts" style="background-color:#f5f5f5;color:#1f1f1f;" class="language-ts "><code class="language-ts" data-lang="ts"><span style="color:#5597d6;">private </span><span style="color:#c23f31;">onClick</span><span>(</span><span style="color:#a2a001;">event</span><span>: </span><span style="color:#5597d6;">React</span><span>.</span><span style="color:#5597d6;">MouseEvent</span><span style="color:#72ab00;">&lt;</span><span>{}</span><span style="color:#72ab00;">&gt;</span><span>) {
</span><span>    </span><span style="color:#a2a001;">event</span><span>.</span><span style="color:#b39f04;">preventDefault</span><span>();
</span><span>    </span><span style="color:#a2a001;">event</span><span>.</span><span style="color:#b39f04;">stopPropagation</span><span>();
</span><span>    </span><span style="color:#7f8989;">// I also changed the props `name` to `to`
</span><span>    </span><span style="color:#668f14;">const </span><span>{</span><span style="color:#5597d6;">to</span><span>, </span><span style="color:#5597d6;">params</span><span>, </span><span style="color:#5597d6;">options</span><span>} </span><span style="color:#72ab00;">= </span><span style="color:#5597d6;">this</span><span>.</span><span style="color:#5597d6;">props</span><span>;
</span><span>    </span><span style="color:#5597d6;">router</span><span>.</span><span style="color:#b39f04;">navigate</span><span>(</span><span style="color:#5597d6;">to</span><span>, </span><span style="color:#5597d6;">params</span><span>, </span><span style="color:#5597d6;">options</span><span>);
</span><span>}
</span></code></pre>
<p>The store also changed in order to only display an animation after a certain amount of time, avoiding blinking effects:</p>
<pre data-lang="ts" style="background-color:#f5f5f5;color:#1f1f1f;" class="language-ts "><code class="language-ts" data-lang="ts"><span style="color:#668f14;">class </span><span style="color:#c23f31;">RouterStore </span><span>{
</span><span>  @</span><span style="color:#5597d6;">observable current</span><span style="color:#72ab00;">: </span><span style="color:#c23f31;">State</span><span>;
</span><span>  @</span><span style="color:#5597d6;">observable asyncInProgress </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">false</span><span>;
</span><span>  </span><span style="color:#7f8989;">// Only happens if the page wasn&#39;t loaded in less than 500ms
</span><span>  @</span><span style="color:#5597d6;">observable showLoadingScreen </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">false</span><span>;
</span><span>  </span><span style="color:#5597d6;">loadingTimeout</span><span style="color:#72ab00;">: </span><span style="color:#a2a001;">null </span><span style="color:#72ab00;">| </span><span style="color:#a2a001;">number</span><span>;
</span><span>
</span><span>  @</span><span style="color:#5597d6;">action </span><span style="color:#c23f31;">setCurrent</span><span>(</span><span style="color:#5597d6;">state</span><span style="color:#72ab00;">: </span><span style="color:#c23f31;">State</span><span>) {
</span><span>    </span><span style="color:#5597d6;">this</span><span>.</span><span style="color:#a2a001;">current </span><span style="color:#72ab00;">= </span><span style="color:#5597d6;">state</span><span>;
</span><span>    </span><span style="color:#5597d6;">this</span><span>.</span><span style="color:#5597d6;">asyncInProgress </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">false</span><span>;
</span><span>    </span><span style="color:#b39f04;">clearTimeout</span><span>(</span><span style="color:#5597d6;">this</span><span>.</span><span style="color:#5597d6;">loadingTimeout</span><span>);
</span><span>    </span><span style="color:#5597d6;">this</span><span>.</span><span style="color:#5597d6;">showLoadingScreen </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">false</span><span>;
</span><span>  }
</span><span>
</span><span>  @</span><span style="color:#5597d6;">action </span><span style="color:#c23f31;">startAsyncLoading</span><span>() {
</span><span>    </span><span style="color:#5597d6;">this</span><span>.</span><span style="color:#5597d6;">asyncInProgress </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">true</span><span>;
</span><span>    </span><span style="color:#5597d6;">this</span><span>.</span><span style="color:#5597d6;">loadingTimeout </span><span style="color:#72ab00;">= </span><span style="color:#b39f04;">setTimeout</span><span>(() </span><span style="color:#668f14;">=&gt; </span><span style="color:#5597d6;">this</span><span>.</span><span style="color:#5597d6;">showLoadingScreen </span><span style="color:#72ab00;">= </span><span style="color:#b3933a;">true</span><span>, </span><span style="color:#b3933a;">500</span><span>);
</span><span>  }
</span><span>}
</span></code></pre>
<p>Any component can now observe <code>showLoadingScreen</code> and render a loading effect very easily. 500 milliseconds is probably
too high but I was on a slow connection several thousands of kilometers away from our servers when I tried it.</p>
<p>The only issue we encountered was that some users were faced with a blank page. I was not able
to reproduce it and no errors were reported to our Sentry server. After a couple of unsuccessful debugging
sessions, I noticed something in the <a href="http://router5.github.io/docs/router-options.html">router5 documentation</a>:
the <code>strictQueryParams</code>.</p>
<p>By default in <code>router5</code>, a route with a path of <code>/</code> will not be matched by the URL <code>/?_ga=blabla</code>:
turns out this was exactly what was happening for Proppy. I
<a href="https://github.com/router5/router5/issues/137">opened an issue</a> to change the default to a saner one and it seems
it will happen, but in the next major version as this is a breaking change. In the meantime,
the paragraph about <code>strictQueryParams</code> got moved to the top in the docs in order to be more visible.</p>
<p>Lastly, someone mailed me mentioning <a href="https://github.com/LeonardoGentile/react-mobx-router5">react-mobx-router5</a> which
was inspired by <a href="https://hackernoon.com/how-to-decouple-state-and-ui-a-k-a-you-dont-need-componentwillmount-cc90b787aa37">the same article</a>
as this serie of posts. I think a library for this routing approach is overkill. Pretty much all the code needed is in
the <a href="https://www.vincentprouillet.com/blog/testing-a-different-spa-routing/">previous article</a> and is less than 100 LOC that you can customise
any way you want since different apps will have different needs.</p>

        </div>
    </div>

    </div>

  <body>
  </body>
</html>
